# sustag_orctrl

We introduce SUSTag-ORCtrL that uses raw ionic current signatures of DNA tags for demultiplexing into 96 or 384 classes. Our system, involving a Bhattacharyya distance and incremental clustering enhanced molecular tag design (SUSTag), an optional-reject CNN-LSTM deep learning model, and a transfer-learning pipeline (ORCtrL), minimizes crosstalk for random access.

## Getting started

### Clone the repository

``` bash
git clone https://github.com/Taltalite/sustag_orctrl.git
```

## Requirements

The project's runtime environment has been packaged into an env.yml file using ```conda env export```. Please ensure that Python version is >= 3.12.0.

For creating a new conda environment using the env.yml:

``` bash
conda env create -f env.yml -n <new_env_name>
```

## Usage

### Download data

The provided datasets and trained network model files can be accessed at https://mirrors.sustech.edu.cn/site/datasets-share/sustag_orctrl/

You can directly download dataset using:

``` bash
curl -O https://mirrors.sustech.edu.cn/site/datasets-share/sustag_orctrl/seq_data/FAR32973.tar.gz
```

``` bash
curl -O https://mirrors.sustech.edu.cn/site/datasets-share/sustag_orctrl/seq_data/accc4117fastq.tar.gz
```

and then extract the dataset:

```bash
tar -xvzf ./FAR32973.tar.gz -C <fast5_dataset_path>
```

```bash
tar -xvzf ./accc4117fastq.tar.gz -C <fastq_dataset_path>
```

### Make dataset

* Mapping the fastq files to reference by runnning ```sustag_orctrl/dataset_gen/mapping.py```

* Generating read dictionary by running ```sustag_orctrl/dataset_gen/readsdic_gen.py```

* Signal slicing by using read dictionary file and gupptbasecalled fast5 files and running ```sustag_orctrl/dataset_gen/data_extraction.py```

* Making dataset for training and testing by runnning ```sustag_orctrl/dataset_gen/pickleset_gen_1d.py```

You can also download small preprocessed dataset from https://mirrors.sustech.edu.cn/site/datasets-share/sustag_orctrl/


### Test

There are three test scripts for different networks in the ```test``` path. You can download the preprocessed dataset and model files and run them after setting the dataset and model file paths correctly in the codes.

e.g.

```bash
conda activate <env_name>
cd ./test/
python test_ORCtrL.py
```

### Train

The training data set needs to be generated by yourself. Be careful not to use the provided data set for training.




